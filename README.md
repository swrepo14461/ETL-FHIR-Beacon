# FHIR to Beacon Conversion Tool

## Introduction

This project provides an Extract, Transform, Load (ETL) script to convert data from SatuSehatâ€™s FHIR R4 resources into the GA4GH Beacon V2 Model. This script is an automation tool that converts data FHIR R4 into Beacons V2 Model individual schema.

## Disclaimer

The accuracy, completeness, and quality of the source data, including field selection and mapping, are the sole responsibility of BGSi as the mapping provider. The output generated by this tool reflects only the data uploaded. BGSi bears full responsibility for any errors, inaccuracies, or losses arising from user inputs or mappings.

## How to Use

This ETL script can be executed in Jupyter Notebook, Google Colab, or any local environment that supports Python 3 and standard Python libraries.

### Requirements

Before running the script, ensure that your environment has:

- Python 3.12 or higher
- Git installed (for cloning the repository)
- Internet access (to download dependencies)

You can use:

- Jupyter Notebook (recommended for step-by-step execution)
- Google Colab (run directly in the cloud, no installation required)
- Any local Python environment (for example, VS Code or a command-line terminal)

### Running in local or cloud-based Notebook

#### 1. Clone the repository

This command downloads the ETL-FHIR-Beacon project from GitHub into your working directory.

```bash
!git clone https://github.com/swrepo14461/ETL-FHIR-Beacon
```

### 2. Change into the project directory

Navigate into the cloned repository so subsequent commands run in the correct folder.

```bash
%cd ETL-FHIR-Beacon/
```

### 3. Install required dependencies

This installs all Python libraries listed in the `requirements.txt` file, which are needed for the ETL process (such as pandas, requests, and FHIR/Beacon data handling libraries).

```bash
!pip install -r requirements.txt
```

### 4. Prepare Input Data

Ensure all your data files are in **FHIR JSON** format and place them into the `FHIR JSON` directory.

### 5. Run the ETL process

Execute the main script to start the extraction, transformation, and validation process on your data.

```bash
!python Main.py
```

#### 6. Check the Results in the Output Folder

After the script finishes, all results will be saved in the `Result` folder. You will find two files that are automatically generated:

* **Beacon File**: Contains the final data that has been successfully transformed into the Beacon format.
* **Summary Validation**: Contains a brief report summarizing the validation results of the processed data.

## FHIR to Beacon Mapper

![FHIR to Beacon Mapping](https://www.plantuml.com/plantuml/png/lLNHJzi-47xFNt7gouzAKFsqHwHD51YYqheoXdZPzd2DByN3iItRgPGX_lTTtAPD6XBGD8qNND_tdR_pTxwS-O0k5BbA_AFK5Xtca2hqVXg2ayiYq2mr-glyHV1_abXC7t55CBgwdjt2BNbJk9Jy29uIsD1WiVJarXYaqN4Nm1VBdvG6E6L2HevqIaSt320TnX6G6a4SlU1_k5HqOHXXGmnHbZ5LhkaI0zt9lCA9xJ82rgWA-bAW3ZAK7AoNsyIvDPhFuS0vIr_oZu-ASjxvzcEZBM0eF8Sh3RppdEmAOHb2_gKoZFOK-aeOq73ZJ4gYSFGlhd90nrGfSgjofeFX1Ugq5cJZuKE2-8ILSUKsBL_xiCmX5LUOIrNEAL-IkvO-SDetowZDdFpPqNCICerDVIcz9UtVx8Wm7bSqqpwu8eqAd2b2duGkcdTegiKj1ehhlbxlYdzklDTpGhu2k7y7SmuhE9hnVQobA52DcwztJkWB5r_8ja0fE2VBaNeLVpCAoulz9SRDV4-xhnxaeJZxGDg4qihqYZ0miXAwNN9Bj7l-4DiZ9Dj4xqhRbcA4p2IvweJvTdru17l8WliIYqsqKMERpQ-0t9fqPOzVkFgDzgR3G8kiHdLUdQq3lUVTES8mu4YeuuUkn4PRP5EHIosP4Fkt2QZwQLCDAj_sBBRFVt0ozCVnELhBEi2HYjdzWxJ-LLxZ6y783wskEuKShOTWuAWrsySTLgTHcjpTw1yd-q7EhDhxFJRPMyFnVdVtXEuqV4rFyiBewb7JdJGH69kWSq4IknDZ_1RVFfj07ZBZG5RrQbIWp4gchr8r4s4qgqcVAjBfTtq22wrAJfQgGX38h9v7x-4faumyZXzZHO74CM3y3ZrNDBvVYoiCL4_IYQldA1Yt7UpDJVGWHQNQm7wecKWTSN2Zg2elsQrWCe56yxG3iJkwsplVszjTwzln5tnk0xhs9cUaHP6htm00)

Before use this application, you can review and adjust the mapping configuration file `mapper.xls`. This file acts as the conversion logic, telling the script exactly how to transform your FHIR data into the Beacon format. **Ensure the paths in this file correctly match the structure of your JSON data.**

#### How to Use the Mapper

| Header                        | Function                                                                                                                                                |
| :---------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Where to Find**       | Identifies the FHIR resource (e.g.,`Observation`, `Condition`, `Procedure`) within the source data that serves as the entry point for extraction. |
| **What to Find First**  | Specifies the FHIR field or path within the selected resource to extract data from (e.g.,`code.coding[0].display`).                                   |
| **What to Find Second** | Defines the next nested field or array element to access after the first key is found, for deeper traversal within the FHIR resource.                   |
| **What to Find Third**  | Indicates a further nested field or array level to reach the exact target data within the FHIR structure.                                               |
| **Type of Find Used**   | Describes how the search is performed in the FHIR structure (e.g., by key name, array index, or nested path).                                           |
| **What to Do**          | Specifies the action after data is located (e.g., extract the value, transform it, or apply validation).                                                |
| **Where to Use**        | Specifies the Beacon model field or nested object within the GA4GH Beacon V2 `Individual` schema where the processed data will be inserted.           |
| **What to Use First**   | Defines the primary Beacon data element or value to initialize or populate the target field.                                                            |
| **What to Use Second**  | Identifies an additional Beacon attribute or nested object used to extend or combine with the first element.                                            |
| **What to Use Third**   | Provides a third Beacon object or subfield for concatenation, mapping, or fallback purposes if applicable.                                              |
| **Type of Use Used**    | Explains how multiple data elements are combined or processed (e.g., assigned directly, concatenated, or derived).                                      |
| **What Must Be Done**   | Defines validation rules for the Beacon field (e.g., required, optional, or conditional).                                                               |
| **Default Value**       | Specifies a static default value if no valid data is found in the FHIR source.                                                                          |

#### Mapping Recommendation

| FHIR Path                                                                                                      | Action    | Beacon Object                                                                |
| :------------------------------------------------------------------------------------------------------------- | :-------- | :--------------------------------------------------------------------------- |
| Patient.id                                                                                                     | Translate | individuals.id                                                               |
| Patient.gender                                                                                                 | Translate | individuals.sex                                                              |
| Patient.birthDate                                                                                              | Translate | individuals.age                                                              |
| AllergyIntolerance.clinicalStatus = "active"                                                                   | Validate  | individuals.phenotypicFeatures                                               |
| AllergyIntolerance.patient.reference                                                                           | Translate | individuals.phenotypicFeatures.id                                            |
| AllergyIntolerance.category                                                                                    | Translate | individuals.phenotypicFeature.featureType.id                                 |
| AllergyIntolerance.code.coding.system                                                                          | Translate | individuals.phenotypicFeature.modifiers.id                                   |
| AllergyIntolerance.code.coding.code                                                                            | Translate | individuals.phenotypicFeature.modifiers.id                                   |
| AllergyIntolerance.code.coding.display                                                                         | Translate | individuals.phenotypicFeature.modifiers.label                                |
| Condition.clinicalStatus = "active"                                                                            | Validate  | individuals.diseases                                                         |
| Condition.subject.reference                                                                                    | Translate | individuals.diseases.id                                                      |
| Condition.code.coding.system                                                                                   | Translate | individuals.diseases.diseasesCode.id                                         |
| Condition.code.coding.code                                                                                     | Translate | individuals.diseases.diseasesCode.id                                         |
| Condition.code.coding.display                                                                                  | Translate | individuals.diseases.diseasesCode.label                                      |
| FamilyMemberHistory.patient.reference                                                                          | Translate | individuals.diseases.id                                                      |
| FamilyMemberHistory.status = "completed"                                                                       | Translate | individuals.diseases.familyHistory = 1                                       |
| FamilyMemberHistory.condition.code.coding.system                                                               | Translate | individuals.diseases.diseasesCode.id                                         |
| FamilyMemberHistory.condition.code.coding.code                                                                 | Translate | individuals.diseases.diseasesCode.id                                         |
| FamilyMemberHistory.condition.code.coding.display                                                              | Translate | individuals.diseases.diseasesCode.label                                      |
| Immunization.status = "completed"                                                                              | Validate  | individuals.treatments                                                       |
| Immunization.patient.reference                                                                                 | Translate | individuals.treatments.id                                                    |
| Immunization.vaccineCode.coding.system                                                                         | Translate | individuals.treatments.treatmentCode.id                                      |
| Immunization.vaccineCode.coding.code                                                                           | Translate | individuals.treatments.treatmentCode.id                                      |
| Immunization.vaccineCode.coding.display                                                                        | Translate | individuals.treatments.treatmentCode.label                                   |
| Medication.code.coding.system                                                                                  | Translate | individuals.treatments.treatmentCode.id                                      |
| Medication.code.coding.code                                                                                    | Translate | individuals.treatments.treatmentCode.id                                      |
| Medication.code.coding.display                                                                                 | Translate | individuals.treatments.treatmentCode.label                                   |
| MedicationDispense.status = "completed"                                                                        | Validate  | individuals.treatments                                                       |
| MedicationDispense.subject.reference                                                                           | Translate | individuals.treatments.id                                                    |
| MedicationDispense.dosageInstruction.route.coding.system                                                       | Translate | individuals.treatments.routeofAdministration.id                              |
| MedicationDispense.dosageInstruction.route.coding.code                                                         | Translate | individuals.treatments.routeofAdministration.id                              |
| MedicationDispense.dosageInstruction.route.coding.display                                                      | Translate | individuals.treatments.routeofAdministration.label                           |
| MedicationDispense.dosageInstruction.doseAndRate.doseQuantity.value                                            | Translate | individuals.treatments.doseIntervals.quantity.value                          |
| MedicationDispense.dosageInstruction.doseAndRate.doseQuantity.unit                                             | Translate | individuals.treatments.doseIntervals.quantity.unit.id                        |
| MedicationDispense.dosageInstruction.patientInstruction                                                        | Translate | individuals.treatments.doseIntervals.scheduleFrequency.label                 |
| MedicationDispense.dosageInstruction.repeat                                                                    | Translate | individuals.treatments.doseIntervals.scheduleFrequency.id                    |
| MedicationDispense.dosageInstruction.repeat.frequency                                                          | Translate | individuals.treatments.doseIntervals.scheduleFrequency.id                    |
| MedicationDispense.dosageInstruction.repeat.periodUnit                                                         | Translate | individuals.treatments.doseIntervals.scheduleFrequency.id                    |
| MedicationDispense.dosageInstruction.repeat.boundsPeriod.start                                                 | Translate | individuals.treatments.doseIntervals.interval.start                          |
| MedicationDispense.dosageInstruction.repeat.boundsPeriod.end                                                   | Translate | individuals.treatments.doseIntervals.interval.end                            |
| MedicationStatement.medicationCodeableConcept.code.coding.system                                               | Translate | individuals.treatments.treatmentCode.id                                      |
| MedicationStatement.medicationCodeableConcept.code.coding.code                                                 | Translate | individuals.treatments.treatmentCode.id                                      |
| MedicationStatement.medicationCodeableConcept.code.coding.display                                              | Translate | individuals.treatments.treatmentCode.label                                   |
| NutritionOrder.status = "active" OR "completed"                                                                | Validate  | individuals.treatments                                                       |
| NutritionOrder.subject.reference                                                                               | Translate | individuals.treatments.id                                                    |
| NutritionOrder.oralDiet.type.coding.system                                                                     | Translate | individuals.treatments.treatmentCode.id                                      |
| NutritionOrder.oralDiet.type.coding.code                                                                       | Translate | individuals.treatments.treatmentCode.id                                      |
| NutritionOrder.oralDiet.type.coding.display                                                                    | Translate | individuals.treatments.treatmentCode.label                                   |
| NutritionOrder.oralDiet.nutrient.modifier.coding.code                                                          | Translate | individuals.treatments.treatmentsCode.id                                     |
| NutritionOrder.oralDiet.nutrient.modifier.coding.display                                                       | Translate | individuals.treatments.treatmentsCode.label                                  |
| NutritionOrder.oralDiet.nutrition.amount.value                                                                 | Translate | individuals.treatments.cumulativeDose.value                                  |
| NutritionOrder.oralDiet.nutrition.amount.unit                                                                  | Translate | individuals.treatments.cumulativeDose.unit.label                             |
| NutritionOrder.oralDiet.nutrition.amount.system                                                                | Translate | individuals.treatments.cumulativeDose.unit.id                                |
| NutritionOrder.oralDiet.nutrition.amount.code                                                                  | Translate | individuals.treatments.cumulativeDose.unit.id                                |
| NutritionOrder.enteralFormula.baseFormulaType.coding.system                                                    | Translate | individuals.treatments.treatmentsCode.id                                     |
| NutritionOrder.enteralFormula.baseFormulaType.coding.code                                                      | Translate | individuals.treatments.treatmentsCode.id                                     |
| NutritionOrder.enteralFormula.baseFormulaType.coding.display                                                   | Translate | individuals.treatments.treatmentsCode.label                                  |
| NutritionOrder.enteralFormula.administration.quantity.value                                                    | Translate | individuals.treatments.cumulativeDose.value                                  |
| NutritionOrder.enteralFormula.administration.quantity.code                                                     | Translate | individuals.treatments.cumulativeDose.unit.id                                |
| NutritionOrder.enteralFormula.administration.quantity.system                                                   | Translate | individuals.treatments.cumulativeDose.unit.id                                |
| NutritionOrder.enteralFormula.administration.quantity.unit                                                     | Translate | individuals.treatments.cumulativeDose.unit.label                             |
| NutritionOrder.enteralFormula.routeOfAdministration.system                                                     | Translate | individuals.treatments.routeofAdministration.id                              |
| NutritionOrder.enteralFormula.routeOfAdministration.code                                                       | Translate | individuals.treatments.routeofAdministration.id                              |
| NutritionOrder.enteralFormula.routeOfAdministration.display                                                    | Translate | individuals.treatments.routeofAdministration.label                           |
| Procedure.status = "completed"                                                                                 | Validate  | individuals.interventionsOrProcedures                                        |
| Procedure.subject.reference                                                                                    | Translate | individuals.interventionsOrProcedures.id                                     |
| Procedure.code.coding.system                                                                                   | Translate | individuals.interventionsOrProcedures.procedureCode.id                       |
| Procedure.code.coding.code                                                                                     | Translate | individuals.interventionsOrProcedures.procedureCode.id                       |
| Procedure.code.coding.display                                                                                  | Translate | individuals.interventionsOrProcedures.procedureCode.label                    |
| Observation.status = "completed"                                                                               | Validate  | measurements\| interventionsOrProcedures \| phenotypicFeatures               |
| Observation.subject.reference                                                                                  | Translate | id for either measurements\| interventionsOrProcedures \| phenotypicFeatures |
| Observation.category.coding.code                                                                               | Validate  | measurements\| interventionsOrProcedures \| phenotypicFeatures               |
| Observation.category.coding.code = "vital-signs"                                                               | Validate  | measurements                                                                 |
| Observation.category.coding.code = "laboratory"                                                                | Validate  | measurements                                                                 |
| Observation.category.coding.code = "exam"                                                                      | Validate  | measurements OR phenotypicFeatures                                           |
| Observation.category.coding.code = "imaging"                                                                   | Validate  | interventionsOrProcedures OR phenotypicFeatures                              |
| Observation.category.coding.code = "procedure"                                                                 | Validate  | interventionsOrProcedures                                                    |
| IF Observation.category.coding.code = "vital-signs"\| "laboratory" \| "exam" and has Observation.valueQuantity |           |                                                                              |
| Observation.valueQuantity                                                                                      | Validate  | individuals.measurements                                                     |
| Observation.code.coding.system                                                                                 | Translate | individuals.measurements.assayCode.id                                        |
| Observation.code.coding.code                                                                                   | Translate | individuals.measurements.assayCode.id                                        |
| Observation.code.coding.display                                                                                | Translate | individuals.measurements.assayCode.label                                     |
| Observation.valueQuantity.value                                                                                | Translate | individuals.measurements.measurementsValue.value                             |
| Observation.valueQuantity.unit                                                                                 | Translate | individuals.measurements.measurementsValue.unit.label                        |
| Observation.valueQuantity.system                                                                               | Translate | individuals.measurements.measurementsValue.unit.id                           |
| Observation.valueQuantity.code                                                                                 | Translate | individuals.measurements.measurementsValue.unit.id                           |
| Observation.effectiveDateTime                                                                                  | Translate | individuals.measurements.date                                                |
| Observation.component                                                                                          | Validate  | individuals.measurements.measurementValue.typedQuantities                    |
| Observation.component.code.coding.system                                                                       | Translate | individuals.measurements.measurementValue.typedQuantities.quantityType.id    |
| Observation.component.code.coding.code                                                                         | Translate | individuals.measurements.measurementValue.typedQuantities.quantityType.id    |
| Observation.component.code.coding.display                                                                      | Translate | individuals.measurements.measurementValue.typedQuantities.quantityType.label |
| Observation.component.valueQuantity.value                                                                      | Translate | individuals.measurements.typedQuantities.quantity.value                      |
| Observation.component.valueQuantity.unit                                                                       | Translate | individuals.measurements.typedQuantities.quantity.unit.label                 |
| Observation.component.valueQuantity.system                                                                     | Translate | individuals.measurements.typedQuantities.quantity.unit.id                    |
| Observation.component.valueQuantity.code                                                                       | Translate | individuals.measurements.typedQuantities.quantity.unit.id                    |
| Observation.interpretation.coding.system                                                                       | Translate | individuals.measurements.notes                                               |
| Observation.interpretation.coding.code                                                                         | Translate | individuals.measurements.notes                                               |
| Observation.interpretation.coding.display                                                                      | Translate | individuals.measurements.notes                                               |
| Observation.referenceRange.low.value                                                                           | Translate | individuals.measurements.measurementsValue.referenceRange.low                |
| Observation.referenceRange.low.unit                                                                            | Translate | individuals.measurements.measurementsValue.referenceRange.unit.label         |
| Observation.referenceRange.low.system                                                                          | Translate | individuals.measurements.measurementsValue.referenceRange.unit.id            |
| Observation.referenceRange.low.code                                                                            | Translate | individuals.measurements.measurementsValue.referenceRange.unit.id            |
| Observation.referenceRange.high.value                                                                          | Translate | individuals.measurements.measurementsValue.referenceRange.high               |
| Observation.referenceRange.high.unit                                                                           | Translate | individuals.measurements.measurementsValue.referenceRange.unit.label         |
| Observation.referenceRange.high.system                                                                         | Translate | individuals.measurements.measurementsValue.referenceRange.unit.id            |
| Observation.referenceRange.high.code                                                                           | Translate | individuals.measurements.measurementsValue.referenceRange.unit.id            |
| IF Observation.category.coding.code = "exam"\| "imaging" and has Observation.component                         |           |                                                                              |
| Observation.code.coding.system                                                                                 | Translate | individuals.phenotypicFeature.featureType.id                                 |
| Observation.code.coding.code                                                                                   | Translate | individuals.phenotypicFeature.featureType.id                                 |
| Observation.code.coding.display                                                                                | Translate | individuals.phenotypicFeature.featureType.label                              |
| Observation.valueBoolean = "true"                                                                              | Validate  |                                                                              |
| Observation.component                                                                                          | Validate  | individuals.phenotypicFeature.modifiers                                      |
| Observation.component.code.coding.system                                                                       | Translate | individuals.phenotypicFeature.modifiers.id                                   |
| Observation.component.code.coding.code                                                                         | Translate | individuals.phenotypicFeature.modifiers.id                                   |
| Observation.code.coding.display                                                                                | Translate | individuals.phenotypicFeature.modifiers.label                                |
| Observation.component.valueCodeableConcept.coding.system                                                       | Translate | individuals.phenotypicFeature.severity.id                                    |
| Observation.component.valueCodeableConcept.coding.code                                                         | Translate | individuals.phenotypicFeature.severity.id                                    |
| Observation.component.valueCodeableConcept.coding.display                                                      | Translate | individuals.phenotypicFeature.severity.label                                 |
| Observation.component.valueBoolean                                                                             | Translate | individuals.phenotypicFeature.excluded                                       |
| IF Observation.category.coding.code = "procedure"\| "imaging"                                                  |           |                                                                              |
| Observation.code.coding.system                                                                                 | Translate | individuals.interventionsOrProcedures.procedureCode.id                       |
| Observation.code.coding.code                                                                                   | Translate | individuals.interventionsOrProcedures.procedureCode.id                       |
| Observation.code.coding.display                                                                                | Translate | individuals.interventionsOrProcedures.procedureCode.label                    |
| Observation.effectiveDateTime                                                                                  | Translate | individuals.interventionsOrProcedures.dateofProcedure                        |
| Observation.valueString                                                                                        | Translate | individuals.interventionsOrProcedures.notes                                  |
